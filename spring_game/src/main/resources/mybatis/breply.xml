<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="breply">

	<insert id="create" parameterType="BreplyDTO">
		insert into breply(breplyno,bbsno,content,breplydate,nicname)
		values((select nvl(max(breplyno),0)+1 as breplyno from breply),
		#{bbsno},#{content},to_char(sysdate,'yyyy-mm-dd'),#{nicname})
	</insert>

	<select id="read" parameterType="int" resultType="BreplyDTO">
		select * from breply where breplyno=#{breplyno}
	</select>

	<update id="update" parameterType="BreplyDTO">
		update breply set content=#{content} where breplyno=#{breplyno}
	</update>

	<delete id="delete" parameterType="int">
		delete from breply where breplyno=#{breplyno}
	</delete>

	<delete id="bdelete" parameterType="int">
		delete from breply where bbsno=#{bbsno}
	</delete>

	<select id="list" parameterType="Map" resultType="BreplyDTO">
		select breplyno,content, breplydate,nicname,r
		from (
			select breplyno,content,breplydate,nicname, rownum as r
			from( 
				select breplyno,content, breplydate,nicname
				from breply
				where bbsno=#{bbsno}
				order by breplyno desc
			)	

<![CDATA[
)where r>=#{sno} and r<=#{eno}
]]>

	</select>

	<select id="total" parameterType="int" resultType="int">
		select count(*) from breply where bbsno=#{bbsno}
	</select>


</mapper>