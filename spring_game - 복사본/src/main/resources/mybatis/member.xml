<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member">

<insert id="create" parameterType="MemberDTO">
insert into member
(id,nicname,mdate,mname,passwd)
values
(#{id},#{nicname},to_char(sysdate,'yyyy-mm-dd'),#{mname},#{passwd})
</insert>

<select id="read" parameterType="String" resultType="MemberDTO">
select id,nicname,mdate,mname,playnum,grade,win
from member where id=#{id}
</select>

<update id="update" parameterType="MemberDTO">
update member 
set nicname=#{nicname}, passwd=#{passwd}
where id=#{id}
</update>

<delete id="delete" parameterType="String">
delete from member where id=#{id}
</delete>

<select id="list" parameterType="Map" resultType="MemberDTO">
select id, nicname, mdate, mname,playnum,win,grade, r
from(
    select id, nicname, mdate, mname,playnum,win, grade,rownum as r
    from(
        select id, nicname, mdate, mname,playnum,win, grade
        from member

    <where>
        <choose>
            <when test="col=='nicname'">
                nicname like '%'||#{word}||'%'
            </when>
            <when test="col=='id'">
                id like '%'||#{word}||'%'
            </when>
        </choose>
    </where>

        order by mdate desc
    )   

<![CDATA[

)where r>=#{sno} and r<=#{eno}

]]>

</select>

<select id="total" parameterType="Map" resultType="int">
select count(*) from member

    <where>
        <choose>
            <when test="col=='nicname'">
                nicname like '%'||#{word}||'%'
            </when>
            <when test="col=='id'">
                id like '%'||#{word}||'%'
            </when>
        </choose>
    </where>

</select>

<select id="loginCheck" parameterType="Map" resultType="int">
select count(id) from member where id=#{id} and passwd=#{passwd}
</select>

<select id="dupliID" parameterType="String" resultType="int">
select count(id) from member where id=#{id}
</select>

<select id="dupliNic" parameterType="String" resultType="int">
select count(nicname) from member where nicname=#{nicname}
</select>

<select id="searchID" parameterType="Map" resultType="String">
select id from member where mname=#{mname} and nicname=#{nicname}
</select>

<select id="searchPW" parameterType="Map" resultType="String">
select passwd from member where mname=#{mname} and id=#{id}
</select>

<select id="getGrade" parameterType="String" resultType="Map">
select grade , nicname from member where id=#{id}
</select>

</mapper>