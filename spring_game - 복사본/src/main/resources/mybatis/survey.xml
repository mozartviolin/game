<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="survey">
	
	<resultMap type="SurveyDTO" id="oneMap">
    	<result property="sno" column="sno"/>
    	<result property="subject" column="subject"/>
    	<result property="answerDTO.sno" column="sno2"/>
    	<result property="answerDTO.subjectno" column="subjectno"/>
    	<result property="answerDTO.choise" column="choise"/>
    	<result property="answerDTO.content" column="content"/>
    	<result property="answerDTO.count" column="count"/>
    </resultMap>
	<select id="oneToOneList" resultMap="oneMap"><!-- selectList로 호출 -->
	   SELECT s.sno , s.subject, a.sno, a.subjectno, a.choise, a.content, a.count 
		FROM survey s, answer a
		WHERE s.sno = a.sno	
    </select>
   	<resultMap type="SurveyDTO" id="manyMap">
   		<result property="sno" column="sno"/>
   		<result property="subject" column="subject"/>
   		<collection property="answerDTOList" column="sno" javaType="List" ofType="answerDTO"
   			resultMap="survey.answerDTOListMap"/>
  	</resultMap>
  	<resultMap type="answerDTO" id="answerDTOListMap">
   		<result property="subjectno" column="subjectno"/>
    	<result property="choise" column="choise"/>
    	<result property="content" column="content"/>
    	<result property="count" column="count"/>
    	<result property="sno" column="sno"/>
   	</resultMap>
   	
   	<select id="oneToManyList" parameterType="int" resultMap="manyMap">
    	SELECT s.sno , s.subject, a.sno, a.subjectno, a.choise, a.content, a.count 
		FROM survey s, answer a
		WHERE s.sno = a.sno	
    </select> 	
	
	<insert id="create" parameterType="SurveyDTO">
		INSERT INTO survey(sno, subject)
  		 VALUES((select nvl(max(sno),0)+1 as sno from survey), #{subject} )
	</insert>
	
	<select id="read" parameterType="int" resultType="SurveyDTO">
		select sno, subject 
			from survey 
			where sno = #{sno}
	</select>
	
	<update id="update" parameterType="int">
		update survey
		set subject = #{subject}
		where sno = #{sno}
	</update>
	
	<delete id="delete" parameterType="int">
		delete from survey where sno = #{sno}
	</delete>
	
	<select id="list" parameterType="Map" resultType="SurveyDTO">
	select sno, subject, r
		from(
			select sno, subject, rownum as r
			from(
				select sno, subject 
				from survey
				order by sno
			)
		)
	<![CDATA[                                                                        
   where r>=#{ssno} and r<=#{eeno}
   ]]>   
	</select>
	
</mapper>