<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">


<insert id = "create" parameterType = "NoticeDTO" >
insert into notice(n_no,subject,content,filename,filesize,ndate,nicname)
values((select nvl(max(n_no),0)+1 as n_no from notice),#{subject},#{content},#{filename,jdbcType=VARCHAR},#{filesize,jdbcType=INTEGER},sysdate,#{nicname})
</insert>

<select id="read" resultType="NoticeDTO" parameterType="int">
		SELECT * FROM notice
		WHERE n_no = #{n_no}
	</select>

<update id="update" parameterType="NoticeDTO">
		UPDATE notice
		SET subject=#{subject},
		content=#{content}

		<if test="filename!=null">
			,filename= #{filename,jdbcType=VARCHAR}
			,filesize = #{filesize,jdbcType=INTEGER}
		</if>
		where n_no = #{n_no}
	</update>

    <delete id = "delete" parameterType="int">
    delete from notice
    where n_no = #{n_no}
    </delete>

	<select id="list" parameterType="Map" resultType="NoticeDTO">

		select n_no, subject ,ndate,viewcnt,nicname, r
		from(
		select n_no, subject ,ndate,viewcnt,nicname,rownum as r
		from(
		select n_no, subject ,ndate,viewcnt,nicname from notice
		<where>
			<choose>
				<when test="col=='subject'">
					subject like '%'||#{word}||'%'
				</when>
			</choose>
		</where>
		order by n_no desc
		) 
<![CDATA[                                                    
)where r>=#{sno} and r<=#{eno}                                      
]]>
	</select>

	<update id="upviewcnt" parameterType="int">
		update notice
		set viewcnt = viewcnt +1
		where n_no = #{n_no}
	</update>

	<select id="total" parameterType="Map" resultType="int">
		select count(*) from notice

		<where>
			<choose>
				<when test="col=='subject'">
					subject like '%'||#{word}||'%'
				</when>
			</choose>
		</where>

	</select>

</mapper>